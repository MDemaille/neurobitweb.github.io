<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <link rel="stylesheet" type="text/css" href="css/index.css">
    <title></title>
</head>

<body>
    <p><ol id="demo"></ol></p>
    <script>
//Image Loading

function getRandomInt(max) 
{
  return Math.floor(Math.random() * max);
}

function DisplayPictures() 
{
      var result = "";
      
      //Parameters
      var nbLoop = 700; //How many repeats on material ?
      var nbImages = 89;
      var nbVideos = 15;
      var videoInterval = 20;

      var videoIndex = 0;
      var observerIndex = 0;
      var totalIndex = 0;

      var imageIndexes = [];
      var securityCount = 10000;
      var _currentIndexDisplayed;
      var _indexToRemove=0;

      var videoProbability = 0.05;
      
      var path = "";

      for(var i = 0; i<nbLoop; i++)
      {
        for(var imgInd = 0; imgInd<nbImages; imgInd++)
        {
            imageIndexes.push(imgInd);
        }

        for(var y = 0; y<nbImages; y++)
        {
            //Select Random Image
            _currentIndexDisplayed = imageIndexes[getRandomInt(imageIndexes.length)];

            //Remove Index From array
            _indexToRemove = imageIndexes.indexOf(_currentIndexDisplayed);
            if (_indexToRemove > -1) { // only splice array when item is found
                imageIndexes.splice(_indexToRemove, 1); // 2nd parameter means remove one item only
            }

            path = "./images/"+_currentIndexDisplayed.toString()+".bmp";
            result += '<img src=' + path + ' alt = "Beret" width="1280" height="960" loading = "lazy">\n <br />'; 

            totalIndex++;
            if(Math.random()<videoProbability)
            { 

                //ObserverLazyLoading
                result += '<div id="lazy_container'+observerIndex.toString()+'"><img id="placeholder_image'+observerIndex.toString()+'" src="./images/1.bmp" fetchpriority="high" /> </div>' 

                //Classic Loading
                //result += '<video controls preload="none" width="1280" height="960" autoplay muted><source src="./videos/1.mp4" type="video/mp4"></video> '

                observerIndex++
            }

        }
    }
    
    //Getting content in the div
    document.getElementById("demo").innerHTML += result;

    //ObserverLoop
    const options = {
      root: null,
      rootMargin: "0px",
      threshold: 0.5
    };

    const observer = new IntersectionObserver(function (entries, observer) {
      entries.forEach(function (entry) {
        if (!entry.isIntersecting) return;

        const img = entry.target;
        const lazyContainer = img.parentElement;
        const index = img.dataset.index;

        lazyContainer.removeChild(img);

        const videoElement = document.createElement("video");

        var indexSrc = videoIndex;
        videoIndex++;
        if(videoIndex == nbVideos)
            videoIndex=0;

        videoElement.src = "./videos/"+indexSrc.toString()+".mp4";
        videoElement.poster = "./videoplaceholder.png";
        videoElement.controls = true;
        videoElement.preload = "none";
        videoElement.width = 1280;
        videoElement.height = 960;

        videoElement.autoplay = true;
        videoElement.muted = true;
        videoElement.playsInline = true;

        lazyContainer.appendChild(videoElement);
        videoElement.load();

        observer.unobserve(img);
     });
     }, options);

    // Loop
    for (let i = 0; i < observerIndex; i++) {
      const img = document.getElementById("placeholder_image" + i);
      if (!img) continue;

      img.dataset.index = i;
      observer.observe(img);
    }
}

DisplayPictures();
</script>
</body>

</html>